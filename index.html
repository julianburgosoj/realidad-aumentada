<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Escanear diseño AR</title>

    <!-- Librerías -->
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.5.0/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.4/dist/mindar-image-aframe.prod.js"></script>

    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: "Poppins", sans-serif;
        background-color: black;
      }

      /* Pantalla inicial */
      #pantalla-inicial {
        position: absolute;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at center, #1b1b1b, #000);
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        z-index: 10;
        color: white;
        text-align: center;
      }

      #btn-escanear {
        background: linear-gradient(90deg, #00c6ff, #0072ff);
        border: none;
        padding: 15px 35px;
        border-radius: 40px;
        color: white;
        font-size: 18px;
        cursor: pointer;
        transition: 0.3s;
      }

      #btn-escanear:hover {
        transform: scale(1.05);
        background: linear-gradient(90deg, #0072ff, #00c6ff);
      }

      /* Escena de AR */
      #escena-ar {
        width: 100%;
        height: 100%;
        display: none; /* Solo se muestra al presionar el botón */
      }

      /* Asegura que la cámara esté al fondo */
      a-scene {
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1;
      }
    </style>
  </head>

  <body>
    <!-- Pantalla inicial -->
    <div id="pantalla-inicial">
      <h1>✨ Escáner de Diseño AR ✨</h1>
      <p>Toca el botón para activar la cámara y ver tu modelo en realidad aumentada</p>
      <button id="btn-escanear">Escanear diseño</button>
    </div>

    <!-- Escena de Realidad Aumentada -->
    <a-scene
      id="escena-ar"
      mindar-image="imageTargetSrc: ./targets.mind;"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      embedded
      renderer="colorManagement: true, physicallyCorrectLights: true, alpha: true"
    >
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-entity mindar-image-target="targetIndex: 0">
        <a-gltf-model
          src="./model.glb"
          rotation="0 180 0"
          scale="0.5 0.5 0.5"
          gesture-handler
        ></a-gltf-model>
      </a-entity>
    </a-scene>

    <script>
      // Muestra la escena solo al presionar el botón
      const btn = document.getElementById("btn-escanear");
      const pantallaInicial = document.getElementById("pantalla-inicial");
      const escenaAR = document.getElementById("escena-ar");

      btn.addEventListener("click", () => {
        pantallaInicial.style.display = "none";
        escenaAR.style.display = "block";
      });
    </script>

    <!-- Permite rotar el modelo con el dedo -->
    <script>
      AFRAME.registerComponent("gesture-handler", {
        init: function () {
          this.isDragging = false;
          this.previousX = 0;

          this.el.sceneEl.canvas.addEventListener("touchstart", (e) => {
            this.isDragging = true;
            this.previousX = e.touches[0].clientX;
          });

          this.el.sceneEl.canvas.addEventListener("touchmove", (e) => {
            if (!this.isDragging) return;
            const deltaX = e.touches[0].clientX - this.previousX;
            this.previousX = e.touches[0].clientX;
            this.el.object3D.rotation.y += deltaX * 0.01;
          });

          this.el.sceneEl.canvas.addEventListener("touchend", () => {
            this.isDragging = false;
          });
        },
      });
    </script>
  </body>
</html>


